#! /bin/sh

TOOLCHAIN_PATCH_DIR=$pwd
BUILDROOT_TC_ARM= $HOME/buildroot-2012.02	# Verzeichnis f√ºr buildroot 2012.02
FT_REPO_DIR= $HOME/freshtomato-arm 		#  Verzeichnis Freshtomato-arm Repo

cd $HOME
cd $BUILDROOT_TC_ARM
wget https://buildroot.org/downloads/buildroot-2012.02.tar.gz
tar -zvxf buildroot-2012.02.tar.gz
mv buildroot-2012.02 .
cp $TOOLCHAIN_PATCH_DIR/defconfig-arm-uclibc .config
chmod 755 support/gnuconfig/config.guess 
chmod 755 support/dependencies/check-host-tar.sh
chmod 755 support/dependencies/dependencies.sh  
chmod 755 support/scripts/setlocalversion
chmod 755 support/scripts/apply-patches.sh

mv dl-save/binutils-2.21.1a.tar.bz2 dl-save/binutils-2.21.1.tar.bz2
wget -P dl-save  https://ftp.gnu.org/gnu/m4/m4-1.4.18.tar.bz2   
mv dl-save/m4-1.4.18.tar.bz2 dl-save/m4-1.4.16.tar.bz2
cp $TOOLCHAIN_PATCH_DIR/m4-1.4.16-glibc-change-work-around.patch packages/m4
cp $TOOLCHAIN_PATCH_DIR/autoconf-2.65-texi-patch2.patch packages/autoconf 
cp $TOOLCHAIN_PATCH_DIR/autoconf-2.65-port-texi-6.3.patch  packages/autoconf 
cp $TOOLCHAIN_PATCH_DIR/900-gcc46-texi.patch, 901_gcc_missing.patch toolchain/gcc/4.5.3 
cp $TOOLCHAIN_PATCH_DIR/902_cfns_fix mismatch in gnu_inline attributes.patch toolchain/gcc/4.5.3
cp $TOOLCHAIN_PATCH_DIR/gcc-uclibc-4.x.mk toolchain/gcc 
cp $TOOLCHAIN_PATCH_DIR/uClibc-0.9.32.1-gen_wctype.patch toolchain/uClibc
rm fs/skeleton/var/cache

cd $FT_REPO_DIR/release/src-rt-6.x.4708/linux
tar cJvf linux-2.6.tar.xz linux-2.6
mv linux-2.6.tar.xz $BUILDROOT_TC_ARM/dl_save

cd $BUILDROOT_TC_ARM

make clean
make

cp $FT_REPO_DIR/release/src-rt-6.x.4708/toolchains/hndtools-arm-linux-2.6.36-uclibc-4.5.3/arm-brcm-linux-uclibcgnueabi/sysroot/usr/include/linux/if_pppox.h output/host/usr/arm-brcm-linux-uclibcgnueabi/sysroot/usr/include/linux/if_pppox.h
cp $FT_REPO_DIR/release/src-rt-6.x.4708/toolchains/hndtools-arm-linux-2.6.36-uclibc-4.5.3/arm-brcm-linux-uclibcgnueabi/sysroot/usr/include/ctype.h  output/host/usr/arm-brcm-linux-uclibcgnueabi/sysroot/usr/include of your toolchain
cp -vrf output/host/usr/arm-brcm-linux-uclibcgnueabi/sysroot/usr/lib output/host/usr/lib
rm -rf $FT_REPO_DIR/release/src-rt-6.x.4708/toolchains/hndtools-arm-linux-2.6.36-uclibc-4.5.3 
cp -vr output/host/usr $FT_REPO_DIR/release/src-rt-6.x.4708/toolchains/hndtools-arm-linux-2.6.36-uclibc-4.5.3/